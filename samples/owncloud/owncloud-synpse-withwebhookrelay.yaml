name: OwnCloud
description: OwnCloud deployment
scheduling:
  type: NoDevices
  selectors: {}
spec:
  containers:
    - name: admin
      image:  mailu/admin:1.8
      ports:
        - 8080:8080
      volumes:
      - "/data/mailu/data:/data"
      - "/data/mailu/dkim:/dkim"
      env:
        - name: SECRET_KEY
          value: J6WIAGJRRTVY5OHH
        - name: DOMAIN
          value: synpse-mail.webrelay.io
        - name: HOSTNAMES
          value: synpse-mail.webrelay.io,synpse.net
        - name: POSTMASTER
          value: admin
        - name: TLS_FLAVOR
          value: letsencrypt
        - name: AUTH_RATELIMIT
          value: 10000/minute
        - name: DISABLE_STATISTICS
          value: "True"
        - name: ADMIN
          value: "True"
        - name: WEBMAIL
          value: none
        - name: WEBDAV
          value: none
        - name: ANTIVIRUS
          value: none
        - name: WEB_ADMIN
          value: /admin
        - name: SITENAME
          value: Synpse.net
        - name: WEBSITE
          value: https://synpse.net
        - name: DB_FLAVOR
          value: sqlite
      restartPolicy: {}
    - name: front
      image: mailu/nginx:1.8
      volumes:
        - /data/mailu/certs:/certs
        - /data/mailu/overrides/nginx:/overrides:ro
      env:
        - name: SECRET_KEY
          value: J6WIAGJRRTVY5OHH
        - name: DOMAIN
          value: synpse-mail.webrelay.io
        - name: HOSTNAMES
          value: synpse-mail.webrelay.io,synpse.net
        - name: POSTMASTER
          value: admin
        - name: TLS_FLAVOR
          value: letsencrypt
        - name: AUTH_RATELIMIT
          value: 10000/minute
        - name: DISABLE_STATISTICS
          value: "True"
        - name: ADMIN
          value: "True"
        - name: WEBMAIL
          value: none
        - name: WEBDAV
          value: none
        - name: ANTIVIRUS
          value: none
        - name: WEB_ADMIN
          value: /admin
        - name: SITENAME
          value: Synpse.net
        - name: WEBSITE
          value: https://synpse.net
        - name: DB_FLAVOR
          value: sqlite
      restartPolicy: {}

    - name: redis
      image: redis:6
      args:
        - --databases
        - "1"
      volumes:
        - /data/mailu/redis:/data
      env:
        - name: MYSQL_ROOT_PASSWORD
          value: owncloud
        - name: MYSQL_USER
          value: owncloud
        - name: MYSQL_PASSWORD
          value: owncloud
        - name: MYSQL_DATABASE
          value: owncloud
      restartPolicy: {}
    - name: relayd
      image: webhookrelay/webhookrelayd:1
      args:
        - --mode
        - tunnel
        - -t
        - synpse-mail
      env:
        - name: RELAY_KEY
          fromSecret: relayKey
        - name: RELAY_SECRET
          fromSecret: relaySecret
      restartPolicy: {}
