name: Drone
description: Drone deployment
scheduling:
  type: AllDevices
spec:
  containers:
  - name: drone
    image: drone/drone:2
    volumes:
      - /data/drone:/data
    env:
      - name: DRONE_GITHUB_CLIENT_ID
        value: xxxxxxxxxxxxxxxxxxxxxx
      - name: DRONE_GITHUB_CLIENT_SECRET
        value: xxxxxxxxxxxxxxxxxxxxxx
      - name: DRONE_RPC_SECRET
        value: xxxxxxxxxxxxxxxxxxxxxxx
      - name: DRONE_SERVER_HOST
        value: drone-mj.webhookrelay.io
      - name: DRONE_SERVER_PROTO
        value: http
      - name: DRONE_USER_CREATE
        value: username:mjudeikis,admin:true
  - name: relayd
    # Note that this AMD64 image. for ARM use webhookrelay/webhookrelayd-aarch64:1
    image: webhookrelay/webhookrelayd:1
    args:
      - --mode
      - tunnel
      - -t
      - drone-mj
    env:
      - name: RELAY_KEY
        fromSecret: relayKey
      - name: RELAY_SECRET
        fromSecret: relaySecret
    restartPolicy: {}

